import sqlite3
import re
import sys

# Conexión a la base de datos (para el ejemplo, usamos SQLite)
conn = sqlite3.connect(':memory:')
cursor = conn.cursor()

# Creación de una tabla de usuarios
cursor.execute("CREATE TABLE users (username TEXT, password TEXT)")
cursor.execute("INSERT INTO users VALUES ('admin', '1234')") 
cursor.execute("INSERT INTO users VALUES ('admin2', '1234')") 
cursor.execute("INSERT INTO users VALUES ('admin3', '1234')") 
cursor.execute("INSERT INTO users VALUES ('admin4', '1234')") 
cursor.execute("INSERT INTO users VALUES ('admin5', '1234')") 
cursor.execute("INSERT INTO users VALUES ('admin6', '1234')")  # Usuario de prueba

# Simulación de entrada del usuario (sin protección contra SQL Injection)
regex = r".*"
# Pedir el nombre de usuario hasta que sea válido
while True:
    user_input = input("Ingresa tu nombre de usuario: ")
    if re.match(regex, user_input):
        print("Entrada válida.")
        break  # Salir del bucle si la entrada es válida
    else:
        print("Entrada inválida. Solo se permiten letras. Inténtalo de nuevo.")
password_input = input("Ingresa tu contraseña: ")

# Consulta SQL vulnerable

query = f"SELECT * FROM users WHERE username = '{user_input}' AND password = '{password_input}'"
print(f"Ejecutando consulta: {query}")

#' OR '1'='1' --  

cursor.execute(query)
result = cursor.fetchall()

print("Todos los usuarios en la tabla:")
for fila in result:
    print(f"Usuario: {fila[0]}, Contraseña: {fila[1]}")

conn.close()



